function loadWidget(c){let{waifuPath:h,apiPath:n,cdnPath:u}=c,m=!1,d;if(typeof u=="string")m=!0,u.endsWith("/")||(u+="/");else if(typeof n=="string")n.endsWith("/")||(n+="/");else{console.error("Invalid initWidget argument!");return}localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
			<div id="waifu-tips"></div>
			<canvas id="live2d" width="800" height="800"></canvas>
			<div id="waifu-tool">
				<span class="fa fa-lg fa-comment"></span>
				<span class="fa fa-lg fa-paper-plane"></span>
				<span class="fa fa-lg fa-user-circle"></span>
				<span class="fa fa-lg fa-street-view"></span>
				<span class="fa fa-lg fa-camera-retro"></span>
				<span class="fa fa-lg fa-info-circle"></span>
				<span class="fa fa-lg fa-times"></span>
			</div>
		</div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0);function f(i){return Array.isArray(i)?i[Math.floor(Math.random()*i.length)]:i}let g=!1,p,w,S=["\u4F60\u6765\u5566\u2026\u2026\u7B49\u4F60\u7B49\u5F97\u90FD\u5FEB\u7761\u7740\u4E86\u2026\u2026","\u4ECA\u5929\u4E5F\u8981\u52AA\u529B\u5B66\u4E60\u9006\u5411\u54E6\uFF01","Pwn\u5B66\u5F97\u5982\u4F55\u5566\u2026\u2026","\u5237\u9898\u5237\u7D2F\u4E86\u5C31\u53BB\u6536\u6C34\u8C31\u5427","\u9001\u4F60\u4E00\u6735\u5C0F\u84DD\u82B1 ^_^"];window.addEventListener("mousemove",()=>g=!0),window.addEventListener("keydown",()=>g=!0),setInterval(()=>{g?(g=!1,clearInterval(p),p=null):p||(p=setInterval(()=>{o(f(S),6e3,9)},2e4))},1e3),function(){document.querySelector("#waifu-tool .fa-comment").addEventListener("click",E),document.querySelector("#waifu-tool .fa-paper-plane").addEventListener("click",()=>{if(window.Asteroids)window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]),window.ASTEROIDSPLAYERS.push(new Asteroids);else{const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js",document.head.appendChild(t)}}),document.querySelector("#waifu-tool .fa-user-circle").addEventListener("click",T),document.querySelector("#waifu-tool .fa-street-view").addEventListener("click",$),document.querySelector("#waifu-tool .fa-camera-retro").addEventListener("click",()=>{o("\u901F\u6218\u901F\u51B3\uFF0C\u7136\u540E\u8BE5\u5403\u5403\u8BE5\u7761\u7761\u2026\u2026",6e3,9),Live2D.captureName="photo.png",Live2D.captureFrame=!0}),document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click",()=>{open("https://github.com/stevenjoezhang/live2d-widget")}),document.querySelector("#waifu-tool .fa-times").addEventListener("click",()=>{localStorage.setItem("waifu-display",Date.now()),o("\u613F\u4F60\u6709\u4E00\u5929\u80FD\u4E0E\u91CD\u8981\u7684\u4EBA\u91CD\u9022\u3002",2e3,11),document.getElementById("waifu").style.bottom="-500px",setTimeout(()=>{document.getElementById("waifu").style.display="none",document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)});const e=()=>{};console.log("%c",e),e.toString=()=>{o("\u4F60\u6253\u5F00\u4E86\u63A7\u5236\u53F0\u5440\u2026\u2026\u662F\u60F3\u770B\u6211\u6795\u5934\u5E95\u4E0B\u7684\u96F6\u82B1\u94B1\u5417\uFF1F",6e3,9)},window.addEventListener("copy",()=>{o("\u4F60\u90FD\u590D\u5236\u4E86\u4E9B\u4EC0\u4E48\u5440\uFF0C\u8F6C\u8F7D\u8981\u8BB0\u5F97\u52A0\u4E0A\u51FA\u5904\u54E6\uFF01\u4E0D\u7136\u2026\u2026\u4E0D\u7136\u4F60\u660E\u5929\u5F00\u65B9\u4FBF\u9762\u5FC5\u65E0\u8C03\u6599\u5305\uFF08\u5212\u6389\uFF09\uFF01",6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||o("\u4F60\u7EC8\u4E8E\u56DE\u6765\u5566\u2026\u2026\u7761\u7740\u4E86\u52FFcue\u2026\u2026zzz",6e3,9)})}(),function(){let e;if(location.pathname==="/"){const t=new Date().getHours();t>5&&t<=7?e="\u65E9\u554A\uFF0C\u8981\u4E0D\u8981\u51FA\u53BB\u996E\u65E9\u8336\uFF1F":t>7&&t<=11?e="\u65E9\u516B\u4EBA\u52A0\u6CB9\u2026\u2026\u6211\u53BB\u7761\u56DE\u7B3C\u89C9\u4E86\u2026\u2026zzzzz":t>11&&t<=13?e="\u5403\u9971\u54AF\u5403\u9971\u54AF\uFF01\u6211\u5927\u6982\u662F\u4E16\u754C\u4E0A\u6700\u5E78\u798F\u7684\u4EBA\u5566\uFF01":t>13&&t<=17?e="zzzzzz\u2026\u2026\u771F\u662F\u4E2A\u7761\u89C9\u7684\u597D\u65F6\u95F4\u2026\u2026":t>17&&t<=19?e="\u665A\u9910\u65F6\u95F4\u5230\u5566\uFF01\u8981\u4E00\u8D77\u5403\u996D\u5417\uFF1F":t>19&&t<=21?e="\u8981\u51FA\u53BB\u6563\u6B65\u5417\uFF1F\u5176\u5B9E\u6211\u662F\u60F3\u987A\u4FBF\u5403\u70B9\u5BB5\u591C\u2026\u2026":t>21&&t<=23?e=["\u5DF2\u7ECF\u8FD9\u4E48\u665A\u4E86\u5440\uFF0C\u65E9\u70B9\u4F11\u606F\uFF0C\u665A\u5B89\u2026\u2026","\u5FEB\u53BB\u7761\u89C9\u5566\u2026\u2026\u79C3\u5934\u53EF\u522B\u6765\u627E\u6211\u501F\u5E3D\u5B50\u54E6\u2026\u2026","\u521A\u521A\u597D\u50CF\u505A\u4E86\u4E2A\u5F88\u68D2\u7684\u68A6\u2026\u2026","\u6211\u80FD\u518D\u7761\u4F1A\u5417\uFF1F\u4F60\u4E5F\u8FC7\u6765\u8DDF\u6211\u4E00\u8D77\u7761\u5566\u2026\u2026"]:e="\u4F60\u771F\u6709\u5E72\u52B2\u554A\uFF0C\u8FD9\u6837\u4E0D\u4F1A\u7D2F\u5417\uFF1F"}else if(document.referrer!==""){const t=new URL(document.referrer),s=t.hostname.split(".")[1];location.hostname===t.hostname?e=`\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" | ")[0]}\u300D</span>`:s==="baidu"?e=`Hello\uFF01\u6765\u81EA \u767E\u5EA6\u641C\u7D22 \u7684\u670B\u53CB<br>\u4F60\u662F\u641C\u7D22 <span>${t.search.split("&wd=")[1].split("&")[0]}</span> \u627E\u5230\u7684\u6211\u5417\uFF1F`:s==="so"?e=`Hello\uFF01\u6765\u81EA 360\u641C\u7D22 \u7684\u670B\u53CB<br>\u4F60\u662F\u641C\u7D22 <span>${t.search.split("&q=")[1].split("&")[0]}</span> \u627E\u5230\u7684\u6211\u5417\uFF1F`:s==="google"?e=`Hello\uFF01\u6765\u81EA \u8C37\u6B4C\u641C\u7D22 \u7684\u670B\u53CB<br>\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`:e=`Hello\uFF01\u6765\u81EA <span>${t.hostname}</span> \u7684\u670B\u53CB`}else e=`\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`;o(e,7e3,8)}();function E(){fetch("https://v1.hitokoto.cn").then(i=>i.json()).then(i=>{const e=`\u8FD9\u53E5\u4E00\u8A00\u6765\u81EA <span>\u300C${i.from}\u300D</span>\uFF0C\u662F <span>${i.creator}</span> \u5728 hitokoto.cn \u6295\u7A3F\u7684\u3002`;o(i.hitokoto,6e3,9),setTimeout(()=>{o(e,4e3,9)},6e3)})}function o(i,e,t){if(!i||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>t)return;w&&(clearTimeout(w),w=null),i=f(i),sessionStorage.setItem("waifu-text",t);const s=document.getElementById("waifu-tips");s.innerHTML=i,s.classList.add("waifu-tips-active"),w=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),s.classList.remove("waifu-tips-active")},e)}(function(){let e=localStorage.getItem("modelId"),t=localStorage.getItem("modelTexturesId");e===null&&(e=0,t=0),v(e,t),fetch(h).then(s=>s.json()).then(s=>{window.addEventListener("mouseover",r=>{for(let{selector:l,text:a}of s.mouseover)if(r.target.matches(l)){a=f(a),a=a.replace("{text}",r.target.innerText),o(a,4e3,8);return}}),window.addEventListener("click",r=>{for(let{selector:l,text:a}of s.click)if(r.target.matches(l)){a=f(a),a=a.replace("{text}",r.target.innerText),o(a,4e3,8);return}}),s.seasons.forEach(({date:r,text:l})=>{const a=new Date,I=r.split("-")[0],L=r.split("-")[1]||I;I.split("/")[0]<=a.getMonth()+1&&a.getMonth()+1<=L.split("/")[0]&&I.split("/")[1]<=a.getDate()&&a.getDate()<=L.split("/")[1]&&(l=f(l),l=l.replace("{year}",a.getFullYear()),S.push(l))})})})();async function y(){d=await(await fetch(`${u}model_list.json`)).json()}async function v(i,e,t){if(localStorage.setItem("modelId",i),localStorage.setItem("modelTexturesId",e),o(t,4e3,10),m){d||await y();const s=f(d.models[i]);loadlive2d("live2d",`${u}model/${s}/index.json`)}else loadlive2d("live2d",`${n}get/?id=${i}-${e}`),console.log(`Live2D \u6A21\u578B ${i}-${e} \u52A0\u8F7D\u5B8C\u6210`)}async function $(){const i=localStorage.getItem("modelId"),e=localStorage.getItem("modelTexturesId");if(m){d||await y();const t=f(d.models[i]);loadlive2d("live2d",`${u}model/${t}/index.json`),o("\u61D2\u5F97\u6362\u88C5\u4E86\u561B\u2026\u2026",4e3,10)}else fetch(`${n}rand_textures/?id=${i}-${e}`).then(t=>t.json()).then(t=>{t.textures.id===1&&(e===1||e===0)?o("\u6211\u8FD8\u6CA1\u6709\u5176\u4ED6\u8863\u670D\u5462\uFF01",4e3,10):v(i,t.textures.id,"\u61D2\u5F97\u6362\u88C5\u4E86\u561B\u2026\u2026")})}async function T(){let i=localStorage.getItem("modelId");if(m){d||await y();const e=++i>=d.models.length?0:i;v(e,0,d.messages[e])}else fetch(`${n}switch/?id=${i}`).then(e=>e.json()).then(e=>{v(e.model.id,0,e.model.message)})}}function initWidget(c,h){typeof c=="string"&&(c={waifuPath:c,apiPath:h}),document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
			<span>\u98DF\u9B42\u7172\u4ED4\u996D</span>
		</div>`);const n=document.getElementById("waifu-toggle");n.addEventListener("click",()=>{n.classList.remove("waifu-toggle-active"),n.getAttribute("first-time")?(loadWidget(c),n.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(n.setAttribute("first-time",!0),setTimeout(()=>{n.classList.add("waifu-toggle-active")},0)):loadWidget(c)}
