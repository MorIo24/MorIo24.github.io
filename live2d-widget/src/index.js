import h from"./model.js";import m from"./message.js";import w from"./utils.js";import u from"./tools.js";function v(s){const f=new h(s);localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
            <div id="waifu-tips"></div>
            <canvas id="live2d" width="800" height="800"></canvas>
            <div id="waifu-tool"></div>
        </div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0),function(){u["switch-model"].callback=()=>f.loadOtherModel(),u["switch-texture"].callback=()=>f.loadRandModel(),Array.isArray(s.tools)||(s.tools=Object.keys(u));for(let e of s.tools)if(u[e]){const{icon:o,callback:i}=u[e];document.getElementById("waifu-tool").insertAdjacentHTML("beforeend",`<span id="waifu-tool-${e}">${o}</span>`),document.getElementById(`waifu-tool-${e}`).addEventListener("click",i)}}();function r(a){if(location.pathname==="/")for(let{hour:i,text:c}of a){const d=new Date,l=i.split("-")[0],n=i.split("-")[1]||l;if(l<=d.getHours()&&d.getHours()<=n)return c}const e=`\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`;let o;if(document.referrer!==""){const i=new URL(document.referrer),c=i.hostname.split(".")[1],d={baidu:"\u767E\u5EA6",so:"360\u641C\u7D22",google:"\u8C37\u6B4C\u641C\u7D22"};return location.hostname===i.hostname?e:(c in d?o=d[c]:o=i.hostname,`Hello\uFF01\u6765\u81EA <span>${o}</span> \u7684\u670B\u53CB<br>${e}`)}return e}function y(a){let e=!1,o,i=a.message.default,c;window.addEventListener("mousemove",()=>e=!0),window.addEventListener("keydown",()=>e=!0),setInterval(()=>{e?(e=!1,clearInterval(o),o=null):o||(o=setInterval(()=>{m(i,6e3,9)},2e4))},1e3),m(r(a.time),7e3,11),window.addEventListener("mouseover",l=>{for(let{selector:n,text:t}of a.mouseover)if(l.target.closest(n)){if(c===n)return;c=n,t=w(t),t=t.replace("{text}",l.target.innerText),m(t,4e3,8);return}}),window.addEventListener("click",l=>{for(let{selector:n,text:t}of a.click)if(l.target.closest(n)){t=w(t),t=t.replace("{text}",l.target.innerText),m(t,4e3,8);return}}),a.seasons.forEach(({date:l,text:n})=>{const t=new Date,g=l.split("-")[0],p=l.split("-")[1]||g;g.split("/")[0]<=t.getMonth()+1&&t.getMonth()+1<=p.split("/")[0]&&g.split("/")[1]<=t.getDate()&&t.getDate()<=p.split("/")[1]&&(n=w(n),n=n.replace("{year}",t.getFullYear()),i.push(n))});const d=()=>{};console.log("%c",d),d.toString=()=>{m(a.message.console,6e3,9)},window.addEventListener("copy",()=>{m(a.message.copy,6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||m(a.message.visibilitychange,6e3,9)})}(function(){let e=localStorage.getItem("modelId"),o=localStorage.getItem("modelTexturesId");e===null&&(e=1,o=53),f.loadModel(e,o),fetch(s.waifuPath).then(i=>i.json()).then(y)})()}function b(s,f){typeof s=="string"&&(s={waifuPath:s,apiPath:f}),document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
            <span>\u770B\u677F\u5A18</span>
        </div>`);const r=document.getElementById("waifu-toggle");r.addEventListener("click",()=>{r.classList.remove("waifu-toggle-active"),r.getAttribute("first-time")?(v(s),r.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(r.setAttribute("first-time",!0),setTimeout(()=>{r.classList.add("waifu-toggle-active")},0)):v(s)}export default b;
